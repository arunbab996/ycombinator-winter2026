<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DiscoveryOS â€” YC feed</title>
<style>
:root{
  --bg:#f6f7f9; --card:#fff; --muted:#6b7280; --accent:#ff6a00;
  --tag-bg:#f1f6fb; --border:#e6e8eb; --glass:rgba(0,0,0,0.03);
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#fbfcfe,#f3f5f7)}
.app{max-width:980px;margin:36px auto;padding:22px}
.header{display:flex;gap:14px;align-items:center;margin-bottom:8px}
.logo{width:52px;height:52px;border-radius:50%;background:var(--card);display:flex;align-items:center;justify-content:center;font-weight:700;color:#111;border:1px solid var(--border)}
h1{font-size:20px;margin:0}
.subtitle{margin:6px 0 18px;color:var(--muted);font-size:13px}

/* controls */
.controls{display:flex;align-items:center;gap:12px;margin-bottom:18px}
.search{margin-left:auto;padding:10px;border-radius:10px;border:1px solid var(--border);min-width:240px}

/* date group */
.date-group{margin-top:18px}
.date-header{font-weight:700;color:#111;margin-bottom:8px}

/* card */
.card{display:flex;gap:14px;align-items:flex-start;padding:14px;border-radius:12px;background:var(--card);border:1px solid var(--border);box-shadow:0 1px 0 rgba(0,0,0,0.02)}
.card + .card{margin-top:12px}
.left{width:56px;height:56px;border-radius:12px;background:var(--glass);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.left img{width:48px;height:48px;object-fit:contain;border-radius:8px}
.center{flex:1;min-width:0}
.title-row{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
.name{font-weight:700;font-size:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.tagline{color:#111;margin-top:8px;font-size:14px;line-height:1.3}
.meta{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
.tag{padding:6px 8px;border-radius:6px;background:var(--tag-bg);font-size:12px;color:#222;border:1px solid rgba(0,0,0,0.03)}

/* actions */
.actions{display:flex;gap:8px;align-items:center}
.btn{
  display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;
  font-weight:600;text-decoration:none;font-size:13px;border:1px solid var(--border);background:#fff;color:#111;
  box-shadow:0 1px 0 rgba(0,0,0,0.03)
}
.btn svg{width:16px;height:16px;display:block}
.btn--site{border-color:#dbeafe}   /* subtle blue */
.btn--yc{border-color:#ffd8cc;background:#fff}

/* empty */
.empty{color:var(--muted);padding:28px;background:var(--card);border:1px dashed var(--border);border-radius:8px;text-align:center;margin-top:16px}
footer{margin-top:26px;color:var(--muted);font-size:13px}

/* responsive */
@media (max-width:740px){
  .controls{flex-direction:column;align-items:stretch}
  .search{width:100%;margin-left:0}
  .title-row{flex-direction:column;align-items:flex-start}
  .actions{margin-top:8px}
}
</style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="logo">DO</div>
      <div>
        <h1>DiscoveryOS â€” YC feed</h1>
        <div class="subtitle">Your radar for breakout startups ðŸš€</div>
      </div>
    </div>

    <div class="controls">
      <!-- (no top hint text per request) -->
      <input id="search" class="search" type="text" placeholder="Search company, tagline or tag" />
    </div>

    <div id="content"></div>

    <footer id="footer-note">
      <!-- footer note removed as requested (kept empty for now) -->
    </footer>
  </div>

<script>
/* ---------- CONFIG - hardcoded sheet you provided ---------- */
const SHEET_ID = '1OaIx6CeopLNuiYQrDUurO_6B-cCHh3g2QMWtC7UDz5U';
const GID = '1286166919';
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`;

/* ---------- CSV parsing helpers ---------- */
function splitCsvLine(line){
  const out=[]; let cur='', inQ=false;
  for(let i=0;i<line.length;i++){
    const ch=line[i];
    if(ch==='\"'){
      if(inQ && line[i+1]==='\"'){ cur+='"'; i++; continue; }
      inQ=!inQ; continue;
    }
    if(ch===',' && !inQ){ out.push(cur); cur=''; continue; }
    cur+=ch;
  }
  out.push(cur);
  return out.map(s=> s.replace(/^\s+|\s+$/g,'').replace(/^"|"$/g,''));
}
function csvToObjects(csv){
  if(!csv) return [];
  const lines = csv.split(/\r?\n/);
  if(lines.length===0) return [];
  const header = splitCsvLine(lines[0]).map(h=>h.trim());
  const rows=[];
  for(let r=1;r<lines.length;r++){
    if(!lines[r]||lines[r].trim()==='') continue;
    const cols = splitCsvLine(lines[r]);
    const obj={};
    header.forEach((h,i)=> obj[h]= (cols[i]||'').trim());
    rows.push(obj);
  }
  return rows;
}

/* ---------- helpers for mapping sheet columns ---------- */
function pickField(row, keys){
  for(const k of keys){
    if(k in row && row[k] !== undefined && row[k] !== null && String(row[k]).trim()!=='') return String(row[k]).trim();
  }
  return '';
}

function normalizeName(raw){
  if(!raw) return '';
  // remove common trailing " | Y Combinator" or "Y Combinator" bits
  return raw.replace(/\s*\|\s*Y\s*Combinator\s*$/i, '')
            .replace(/\s*Y\s*Combinator\s*$/i, '')
            .trim();
}

function getDomain(url){
  try{ if(!url) return null; const u = new URL(url.startsWith('http')? url : 'https://'+url); return u.hostname; }catch(e){ return null; }
}
function favIconFor(row){
  const candidates = ['IconURL','icon','Logo','logo'];
  for(const k of candidates){ if(row[k] && String(row[k]).trim()!=='') return row[k].trim(); }
  const site = pickField(row, ['Correct Website','Website','Site','URL','Company Website']);
  const domain = getDomain(site);
  if(domain) return `https://www.google.com/s2/favicons?sz=128&domain=${domain}`;
  return null;
}
function parseDate(row){
  // prefer Extracted Date or ExtractedDate, then Date
  let d = pickField(row, ['Extracted Date','ExtractedDate','Date','Extracted_Date']);
  if(!d) return '';
  // try to coerce numeric dates, etc.
  const parsed = new Date(d);
  if(!isNaN(parsed)) return parsed.toISOString().slice(0,10);
  return d.trim();
}
function formatDateReadable(ds){
  const d = new Date(ds);
  if(isNaN(d)) return ds;
  return d.toLocaleDateString(undefined,{year:'numeric',month:'long',day:'numeric'});
}

/* ---------- grouping & rendering ---------- */
function groupByDate(rows){
  const groups = {};
  rows.forEach(r=>{
    const key = parseDate(r) || 'Unknown';
    if(!groups[key]) groups[key]=[];
    groups[key].push(r);
  });
  return groups;
}

function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* nicer button SVGs */
const siteSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M12 2a10 10 0 100 20 10 10 0 000-20z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12h20M12 2c2.5 2.8 4 6.5 4 10s-1.5 7.2-4 10M12 2C9.5 4.8 8 8.5 8 12s1.5 7.2 4 10" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
const ycSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><rect width="24" height="24" rx="6" fill="#ff8a00"/><path d="M8 12h8" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>`;

/* render function */
function render(groups, search=''){
  const content = document.getElementById('content');
  const keys = Object.keys(groups);
  if(!keys.length){ content.innerHTML = `<div class="empty">No companies found</div>`; return; }
  // sort descending
  keys.sort((a,b)=> b.localeCompare(a));
  const q = (search||'').toLowerCase().trim();

  let html='';
  keys.forEach(k=>{
    const items = groups[k].filter(r=>{
      // build searchable haystack
      const name = normalizeName(pickField(r, ['Correct Name','CorrectName','Name','Company','company','Company Name']));
      const tagline = pickField(r, ['Correct Tagline','CorrectTagline','Tagline','Correct Tagline','Description','Correct Tagline']);
      const tags = pickField(r, ['Tags','tags']);
      const hay = `${name} ${tagline} ${tags}`.toLowerCase();
      if(!q) return true;
      return hay.includes(q);
    });
    if(!items.length) return;
    html += `<section class="date-group"><div class="date-header">${escapeHtml(formatDateReadable(k))}</div>`;
    items.forEach(r=>{
      const rawName = pickField(r, ['Correct Name','CorrectName','Name','Company','Company Name']);
      const name = normalizeName(rawName);
      if(!name || name === '#VALUE!') return;
      const tagline = pickField(r, ['Correct Tagline','CorrectTagline','Tagline','Description','Correct Tagline']);
      const tags = (pickField(r, ['Tags','tags']) || '').split(',').map(t=>t.trim()).filter(Boolean);
      const website = pickField(r, ['Correct Website','Website','Site','URL','Company Website']);
      const yc = pickField(r, ['YC URL','YC Link','Y Combinator','YC','YC URL','YCombinator']);
      const logo = favIconFor(r);

      // create action buttons (only when present)
      const actions = [];
      if(website){
        const href = website.startsWith('http') ? website : 'https://'+website;
        actions.push(`<a class="btn btn--site" target="_blank" rel="noopener noreferrer" href="${escapeHtml(href)}">${siteSvg}<span>Website</span></a>`);
      }
      if(yc){
        const href = yc.startsWith('http') ? yc : 'https://'+yc;
        actions.push(`<a class="btn btn--yc" target="_blank" rel="noopener noreferrer" href="${escapeHtml(href)}">${ycSvg}<span>YC</span></a>`);
      }

      html += `
        <article class="card">
          <div class="left">${logo?`<img src="${escapeHtml(logo)}" alt="${escapeHtml(name)} logo" onerror="this.style.display='none'">`:`<div style="font-weight:700;color:#111">${escapeHtml((name[0]||'').toUpperCase())}</div>`}</div>
          <div class="center">
            <div class="title-row">
              <div style="min-width:0">
                <div class="name">${escapeHtml(name)}</div>
                ${tagline?`<div class="tagline">${escapeHtml(tagline)}</div>`:''}
                ${tags.length?`<div class="meta">${tags.map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join('')}</div>`:''}
              </div>
              <div class="actions">
                ${actions.join('')}
              </div>
            </div>
          </div>
        </article>
      `;
    });
    html += `</section>`;
  });

  content.innerHTML = html || `<div class="empty">No companies match your search</div>`;
}

/* ---------- load CSV and wire search ---------- */
async function loadAndRender(){
  const content = document.getElementById('content');
  content.innerHTML = `<div class="empty">Loading companies...</div>`;
  try{
    const resp = await fetch(CSV_URL);
    if(!resp.ok) throw new Error('Sheet not accessible (status '+resp.status+'). Make sure the sheet is published or shared for public export.');
    const txt = await resp.text();
    const rows = csvToObjects(txt);

    // Build normalized rows and filter
    const normalized = rows.map(r=>{
      const o={};
      // copy trimmed keys
      Object.keys(r).forEach(k=> o[k.trim()] = r[k].trim());
      return o;
    }).filter(r=>{
      // choose canonical name - prefer Correct Name over Name; skip #VALUE!
      const name = pickField(r, ['Correct Name','CorrectName','Name','Company','Company Name']);
      return name && name.trim() && name.trim() !== '#VALUE!';
    });

    if(!normalized.length){
      content.innerHTML = `<div class="empty">No valid rows found. Make sure the sheet is published as CSV and contains the expected columns.</div>`;
      return;
    }

    // group by extracted date (or Date)
    const groups = groupByDate(normalized);
    window.__DISCOVERY_GROUPS = groups;
    render(groups, document.getElementById('search').value);
  }catch(err){
    content.innerHTML = `<div class="empty">Error loading sheet: ${escapeHtml(err.message)}</div>`;
    console.error(err);
  }
}

document.getElementById('search').addEventListener('input', ()=>{
  render(window.__DISCOVERY_GROUPS || {}, document.getElementById('search').value);
});

loadAndRender();
</script>
</body>
</html>
