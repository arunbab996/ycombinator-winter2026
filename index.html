<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DiscoveryOS</title>

<style>
:root{
  /* Matte black palette */
  --bg:#000000;
  --bg-elevated:#070707;
  --bg-card:#0A0A0A;
  --border:#1A1A1A;
  --border-soft:#121212;

  --text:#F4F4F5;
  --text-soft:#9A9A9A;
  --text-softer:#6E6E6E;

  --accent:#F97316;
  --accent-soft:#F9B57A;
  --accent-link:#E4E4E7;

  --yc-pill-bg:rgba(249,115,22,0.14);
  --yc-pill-border:rgba(249,115,22,0.6);

  font-family:system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Text",
               "Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
}

*{box-sizing:border-box;}

html,body{
  margin:0;
  padding:0;
  min-height:100vh;
  background:var(--bg);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
}

body{
  display:flex;
  flex-direction:column;
}

/* WIDE LAYOUT */
.app{
  flex:1;
  width:100%;
  margin:24px 0 32px 0;
  padding:0 28px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* HEADER */
.app-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
}

.brand{
  display:flex;
  align-items:center;
  gap:10px;
}

.brand-mark{
  position:relative;
  width:30px;
  height:30px;
  border-radius:10px;
  border:1px solid #262626;
  background:#050505;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  color:#E5E5E5;
  overflow:hidden;
}

/* subtle grid lines inside mark */
.brand-mark::before,
.brand-mark::after{
  content:"";
  position:absolute;
}
.brand-mark::before{
  width:18px;
  height:1px;
  background:#141414;
  box-shadow:0 4px 0 #141414;
}
.brand-mark::after{
  width:1px;
  height:18px;
  background:#141414;
  box-shadow:4px 0 0 #141414;
}

.brand-text{
  display:flex;
  flex-direction:column;
  gap:2px;
}

.brand-name{
  font-size:14px;
  letter-spacing:0.24em;
  text-transform:uppercase;
  font-weight:500;
  color:#F4F4F5;
}

.brand-sub{
  font-size:11px;
  color:var(--text-softer);
}

.app-meta{
  font-size:11px;
  color:var(--text-soft);
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:4px;
}

.app-meta-pill{
  border-radius:999px;
  padding:4px 10px;
  border:1px solid var(--border);
  background:#050505;
  display:flex;
  align-items:center;
  gap:6px;
}
.app-meta-dot{
  width:6px;
  height:6px;
  border-radius:999px;
  background:#22C55E;
}

/* TOOLBAR */
.toolbar{
  background:var(--bg-elevated);
  border-radius:12px;
  border:1px solid var(--border-soft);
  padding:8px 10px 10px 14px;
  display:flex;
  align-items:center;
  gap:10px;
}

.toolbar-main{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:4px;
}

.toolbar-title{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:0.22em;
  color:var(--text-soft);
}

/* SEARCH */
.search-label{
  margin-top:2px;
  font-size:12px;
  font-weight:600;
}

.search-wrap{
  display:flex;
  align-items:center;
  gap:8px;
  margin-top:2px;
}

.search-box{
  position:relative;
  flex:1;
}

.search-box input{
  width:100%;
  padding:7px 10px 7px 24px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#080808;
  color:var(--text);
  font-size:12px;
}
.search-box input::placeholder{
  color:#4A4A4A;
}

.search-icon{
  position:absolute;
  left:8px;
  top:50%;
  transform:translateY(-50%);
  font-size:11px;
  color:var(--text-softer);
}

/* FILTER CHIPS */
.chips{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  font-size:11px;
}

.chip{
  padding:4px 8px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#080808;
  color:var(--text-softer);
  cursor:pointer;
}
.chip--on{
  border-color:#3F3F3F;
  color:var(--text-soft);
}

/* VIEW TOGGLE */
.view-toggle{
  display:flex;
  align-items:center;
  border-radius:999px;
  border:1px solid var(--border);
  background:#080808;
  overflow:hidden;
}

.view-btn{
  padding:4px 10px;
  font-size:11px;
  border:none;
  background:transparent;
  color:var(--text-softer);
  cursor:pointer;
}
.view-btn--active{
  background:#101010;
  color:var(--text);
}

/* FEED */
.feed{
  margin-top:2px;
  background:var(--bg-elevated);
  border-radius:12px;
  border:1px solid var(--border-soft);
  padding:8px 12px 10px;
}

/* SUMMARY BAR */
.summary{
  font-size:11px;
  color:var(--text-soft);
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 2px 4px;
  border-bottom:1px solid var(--border-soft);
}

/* TODAY LABEL */
.today-label{
  font-size:12px;
  font-weight:600;
  margin:6px 2px 2px;
  color:var(--text-soft);
}

/* DATE GROUPS */
.date-group{
  margin-top:6px;
}
.date-header{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:0.16em;
  color:var(--text-soft);
  margin-bottom:4px;
}

/* CARDS */
.card{
  display:flex;
  align-items:flex-start;
  gap:10px;
  padding:8px 10px;
  border-radius:10px;
  background:var(--bg-card);
  border:1px solid var(--border-soft);
}
.card + .card{
  margin-top:4px;
}

.card-left{
  width:40px;
  height:40px;
  border-radius:10px;
  background:#080808;
  border:1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
  overflow:hidden;
}
.card-left img{
  max-width:34px !important;
  max-height:34px !important;
  width:auto;
  height:auto;
  object-fit:contain !important;
}
.card-left-fallback{
  font-size:12px;
  color:var(--text-soft);
}

.card-center{
  flex:1;
}

.card-top-row{
  display:flex;
  align-items:flex-start;
  gap:8px;
}

.card-main{
  flex:1;
  min-width:0;
}

.card-name{
  font-size:14px;
  font-weight:500;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.card-tagline{
  margin-top:3px;
  font-size:12px;
  color:var(--text-soft);
  line-height:1.35;
}

/* ACTIONS */
.card-right{
  display:flex;
  flex-direction:column;
  gap:6px;
  align-items:flex-end;
}
.yc-pill{
  padding:4px 8px;
  border-radius:999px;
  font-size:11px;
  background:var(--yc-pill-bg);
  border:1px solid var(--yc-pill-border);
  color:var(--accent-soft);
}

.btn-link{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:26px;
  height:26px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#080808;
  color:var(--text-soft);
  text-decoration:none;
}
.card-link-row{
  display:flex;
  align-items:center;
  gap:4px;
}

/* TABLE VIEW */
.table-view{
  width:100%;
  border-collapse:collapse;
  margin-top:8px;
  font-size:12px;
}

.table-view thead{
  background:#080808;
}

.table-view th,
.table-view td{
  padding:6px 8px;
  border-bottom:1px solid var(--border-soft);
}

.table-view th{
  text-align:left;
  font-weight:500;
  color:var(--text-soft);
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:0.12em;
}

.table-company{
  font-weight:500;
}
.table-tagline{
  color:var(--text-soft);
}

/* EMPTY */
.empty{
  padding:20px 10px;
  font-size:13px;
  color:var(--text-soft);
  text-align:center;
}

/* FOOTER */
.footer{
  margin-top:auto;
  padding:10px 28px 14px;
  font-size:11px;
  color:var(--text-softer);
  display:flex;
  justify-content:space-between;
}
.footer a{
  color:var(--accent-link);
  text-decoration:none;
}

/* SCROLLBAR */
.feed::-webkit-scrollbar{
  width:6px;
}
.feed::-webkit-scrollbar-track{
  background:transparent;
}
.feed::-webkit-scrollbar-thumb{
  background:#1A1A1A;
  border-radius:999px;
}

/* RESPONSIVE */
@media (max-width:720px){
  .app{
    padding:0 16px 16px;
  }
  .app-header{
    flex-direction:column;
    align-items:flex-start;
  }
  .toolbar{
    flex-direction:column;
    align-items:flex-start;
  }
  .search-wrap{
    flex-wrap:wrap;
  }
  .card-top-row{
    flex-direction:column;
    align-items:flex-start;
  }
  .card-right{
    flex-direction:row;
    align-items:center;
  }
}
</style>
</head>

<body>
<div class="app">
  <!-- HEADER -->
  <header class="app-header">
    <div class="brand">
      <div class="brand-mark">▦</div>
      <div class="brand-text">
        <div class="brand-name">DISCOVERY OS</div>
        <div class="brand-sub">Market intelligence on emerging companies</div>
      </div>
    </div>
    <div class="app-meta">
      <div class="app-meta-pill">
        <span class="app-meta-dot"></span>
        <span id="last-updated">Syncing from sheet…</span>
      </div>
    </div>
  </header>

  <!-- TOOLBAR -->
  <section class="toolbar">
    <div class="toolbar-main">
      <div class="toolbar-title">Discoveries</div>

      <div class="search-label">Search</div>

      <div class="search-wrap">
        <div class="search-box">
          <span class="search-icon">⌕</span>
          <input id="search" type="text" placeholder="Search by company or tagline" />
        </div>

        <div class="chips">
          <button class="chip chip--on" data-filter="all">All</button>
          <button class="chip" data-filter="yc">YC W26</button>
          <button class="chip" data-filter="ph">Product Hunt</button>
        </div>

        <div class="view-toggle">
          <button class="view-btn view-btn--active" data-view="cards">Cards</button>
          <button class="view-btn" data-view="table">Table</button>
        </div>
      </div>
    </div>
  </section>

  <!-- FEED -->
  <section class="feed">
    <div class="summary">
      <span id="summary-text">Showing 0 companies</span>
      <span id="summary-breakdown"></span>
    </div>

    <div id="today-label" class="today-label"></div>

    <div id="content"></div>
  </section>
</div>

<!-- FOOTER -->
<footer class="footer">
  <span>© DiscoveryOS. Internal-style feed for market scouts, not a marketing site.</span>
  <span>
    <a href="#">Docs</a> · <a href="#">Changelog</a>
  </span>
</footer>

<script>
/* CONFIG */
const SHEET_ID='1OaIx6CeopLNuiYQrDUurO_6B-cCHh3g2QMWtC7UDz5U';
const GID='1778821196';
const CSV_URL=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`;

let STATE={groups:{},search:"",source:"all",view:"cards"};

/* CSV helpers */
function splitCsvLine(line){
  const out=[];let cur='',q=false;
  for(let i=0;i<line.length;i++){
    const ch=line[i];
    if(ch==='\"'){
      if(q && line[i+1]==='\"'){cur+='"';i++;continue;}
      q=!q;continue;
    }
    if(ch===','&&!q){out.push(cur);cur='';continue;}
    cur+=ch;
  }
  out.push(cur);
  return out.map(s=>s.trim().replace(/^"|"$/g,''));
}
function csvToObjects(csv){
  const lines=csv.split(/\r?\n/).filter(x=>x.trim());
  if(!lines.length)return[];
  const h=splitCsvLine(lines[0]);
  return lines.slice(1).map(l=>{
    const cols=splitCsvLine(l);const o={};
    h.forEach((hh,i)=>o[hh]=cols[i]||'');
    return o;
  });
}

function pick(r,k){
  for(const x of k){
    if(x in r && r[x] && r[x].trim())return r[x].trim();
  }
  return"";
}
function favicon(u){
  try{
    if(!u)return null;
    const d=new URL(u.startsWith('http')?u:`https://${u}`).hostname;
    return `https://www.google.com/s2/favicons?sz=128&domain=${d}`;
  }catch{return null;}
}
function companyLogo(r){
  const s=pick(r,['source','Source']).toLowerCase(),
        logo=pick(r,['Logo URL','LogoURL','Logo_Url']),
        site=pick(r,['Website']);
  if(s==='ph'&&logo)return logo;
  return favicon(site);
}
function parseDate(r){
  const d=pick(r,['Extracted Date','ExtractedDate','Date']);
  const dt=new Date(d);
  return isNaN(dt)?d:dt.toISOString().slice(0,10);
}
function formatDate(d){
  const dt=new Date(d);
  return isNaN(dt)?d||'':
    dt.toLocaleDateString(undefined,{year:'numeric',month:'short',day:'2-digit'});
}
function groupByDate(rows){
  const g={};
  rows.forEach(r=>{
    const key=parseDate(r)||'Unknown';
    (g[key]=g[key]||[]).push(r);
  });
  return g;
}
function esc(s){
  return String(s||'').replace(/&/g,'&amp;')
                      .replace(/</g,'&lt;')
                      .replace(/>/g,'&gt;');
}

const siteIcon=`<svg width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8.2" stroke="currentColor" stroke-width="1.4" fill="none"/><path d="M8 12h8M12 8v8" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>`;
const ycIcon=`<svg width="16" height="16" viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="3" fill="#FF8A00"/><path d="M9 9l3 4 3-4" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 13v3" stroke="#fff" stroke-width="1.4" stroke-linecap="round"/></svg>`;
const phIcon=`<svg width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" fill="#FF6A00"/><path d="M9 8h4a3 3 0 0 1 0 6H9V8z" fill="#fff"/><rect x="9" y="8" width="2" height="8" fill="#fff"/></svg>`;
function iconFor(s){return s==='ph'?phIcon:ycIcon;}

function render(){
  const g=STATE.groups,
        q=(STATE.search||"").toLowerCase().trim(),
        f=STATE.source,
        vm=STATE.view;

  const cont=document.getElementById('content'),
        sum=document.getElementById('summary-text'),
        br=document.getElementById('summary-breakdown'),
        tl=document.getElementById('today-label');

  const dates=Object.keys(g).sort((a,b)=>b.localeCompare(a));
  let latest=null,total=0,yc=0,ph=0;
  const rows=[];

  dates.forEach(dt=>{
    g[dt].forEach(r=>{
      const n=pick(r,['Correct Name','CorrectName','Name']);
      if(!n||n==='#VALUE!')return;
      const src=pick(r,['source','Source']).toLowerCase();
      if(f==='yc'&&src!=='yc')return;
      if(f==='ph'&&src!=='ph')return;
      const tag=pick(r,['Correct Tagline','CorrectTagline','Tagline']);
      if(q && !(n+' '+tag).toLowerCase().includes(q))return;

      latest=latest||dt;
      total++;
      if(src==='yc')yc++;
      if(src==='ph')ph++;

      rows.push({
        dt,
        n,
        tag,
        src,
        site:pick(r,['Website']),
        page:pick(r,['YC URL','YC']),
        logo:companyLogo(r)
      });
    });
  });

  tl.textContent = latest ? `Today's feed · ${formatDate(latest)}` : '';

  sum.textContent=`Showing ${total} compan${total===1?'y':'ies'}`;
  br.textContent=`YC: ${yc} · PH: ${ph}`;

  if(!rows.length){
    cont.innerHTML=`<div class="empty">No companies match this search/filter.</div>`;
    return;
  }

  if(vm==='table'){
    let h=`<table class="table-view">
      <thead>
        <tr>
          <th>Date</th>
          <th>Company</th>
          <th>Tagline</th>
          <th>Source</th>
          <th></th>
        </tr>
      </thead>
      <tbody>`;
    rows.forEach(x=>{
      const siteHref=x.site? (x.site.startsWith('http')?x.site:`https://${x.site}`):null;
      const pageHref=x.page? (x.page.startsWith('http')?x.page:`https://${x.page}`):null;
      h+=`<tr>
        <td>${esc(formatDate(x.dt))}</td>
        <td class="table-company">${esc(x.n)}</td>
        <td class="table-tagline">${esc(x.tag)}</td>
        <td>${x.src.toUpperCase()}</td>
        <td>
          <div class="card-link-row">
            ${siteHref?`<a class="btn-link" target="_blank" href="${esc(siteHref)}">${siteIcon}</a>`:''}
            ${pageHref?`<a class="btn-link" target="_blank" href="${esc(pageHref)}">${iconFor(x.src)}</a>`:''}
          </div>
        </td>
      </tr>`;
    });
    cont.innerHTML=h+`</tbody></table>`;
  }else{
    const grouped={};
    rows.forEach(r=>{(grouped[r.dt]=grouped[r.dt]||[]).push(r);});
    let out="";
    Object.keys(grouped).sort((a,b)=>b.localeCompare(a)).forEach(d=>{
      out+=`<section class="date-group"><div class="date-header">${esc(formatDate(d))}</div>`;
      grouped[d].forEach(x=>{
        const siteHref=x.site? (x.site.startsWith('http')?x.site:`https://${x.site}`):null;
        const pageHref=x.page? (x.page.startsWith('http')?x.page:`https://${x.page}`):null;
        out+=`
        <article class="card">
          <div class="card-left">
            ${x.logo?`<img src="${esc(x.logo)}" alt="">`:`<div class="card-left-fallback">${esc(x.n[0]||'•')}</div>`}
          </div>
          <div class="card-center">
            <div class="card-top-row">
              <div class="card-main">
                <div class="card-name">${esc(x.n)}</div>
                ${x.tag?`<div class="card-tagline">${esc(x.tag)}</div>`:''}
              </div>
              <div class="card-right">
                ${x.src==='yc'?`<div class="yc-pill">YC W26</div>`:''}
                <div class="card-link-row">
                  ${siteHref?`<a class="btn-link" href="${esc(siteHref)}" target="_blank">${siteIcon}</a>`:''}
                  ${pageHref?`<a class="btn-link" href="${esc(pageHref)}" target="_blank">${iconFor(x.src)}</a>`:''}
                </div>
              </div>
            </div>
          </div>
        </article>`;
      });
      out+=`</section>`;
    });
    cont.innerHTML=out;
  }
}

async function load(){
  const content=document.getElementById('content');
  const lastEl=document.getElementById('last-updated');
  content.innerHTML=`<div class="empty">Loading from Google Sheets…</div>`;
  try{
    const txt=await (await fetch(CSV_URL)).text();
    const rows=csvToObjects(txt);
    const valid=rows.filter(r=>pick(r,['Correct Name','CorrectName','Name']));
    STATE.groups=groupByDate(valid);
    render();
    const d=new Date();
    lastEl.textContent=
      `Last sync: ${d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})} · `+
      d.toLocaleDateString([], {day:'2-digit',month:'short'});
  }catch(e){
    content.innerHTML=`<div class="empty">${esc(e.message)}</div>`;
    lastEl.textContent='Error fetching sheet';
  }
}

/* events */
document.getElementById('search').addEventListener('input',e=>{
  STATE.search=e.target.value;
  render();
});
document.querySelectorAll('.chip').forEach(c=>{
  c.addEventListener('click',()=>{
    STATE.source=c.dataset.filter;
    document.querySelectorAll('.chip').forEach(x=>x.classList.remove('chip--on'));
    c.classList.add('chip--on');
    render();
  });
});
document.querySelectorAll('.view-btn').forEach(b=>{
  b.addEventListener('click',()=>{
    STATE.view=b.dataset.view;
    document.querySelectorAll('.view-btn').forEach(x=>x.classList.remove('view-btn--active'));
    b.classList.add('view-btn--active');
    render();
  });
});

load();
</script>
</body>
</html>
