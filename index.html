<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<title>DiscoveryOS</title>

<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Crect width='64' height='64' fill='%23FF8A00'/%3E%3C/svg%3E">

<style>
:root{
  --bg:#f6f7f9;
  --card:#fff;
  --muted:#6b7280;
  --accent:#ff6a00;
  --tag-bg:#f1f6fb;
  --border:#e6e8eb;
  --glass:rgba(0,0,0,0.03);
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
}

html,body{
  height:100%;
  margin:0;
  background:linear-gradient(180deg,#fbfcfe,#f3f5f7);
}

.app{
  max-width:980px;
  margin:36px auto;
  padding:22px;
}

/* header */
.header{
  display:flex;
  gap:14px;
  align-items:center;
  margin-bottom:8px;
}

.logo{
  width:52px;
  height:52px;
  border-radius:50%;
  background:var(--card);
  display:flex;
  align-items:center;
  justify-content:center;
  border:1px solid var(--border);
  overflow:hidden;
  flex-shrink:0;
}

.logo img{
  width:40px;
  height:40px;
  object-fit:contain;
}

.title-wrapper{
  display:flex;
  flex-direction:column;
}

h1{
  font-size:20px;
  margin:0;
}

.subtitle{
  margin:6px 0 18px;
  color:var(--muted);
  font-size:13px;
}

/* controls */
.controls{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:18px;
}

.search{
  margin-left:auto;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--border);
  min-width:240px;
}

/* date group */
.date-group{
  margin-top:18px;
}

.date-header{
  font-weight:700;
  color:#111;
  margin-bottom:8px;
}

/* cards */
.card{
  display:flex;
  gap:14px;
  align-items:flex-start;
  padding:14px;
  border-radius:12px;
  background:var(--card);
  border:1px solid var(--border);
  box-shadow:0 1px 0 rgba(0,0,0,0.02);
}

.card + .card{
  margin-top:12px;
}

.left{
  width:56px;
  height:56px;
  border-radius:12px;
  background:var(--glass);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
}

/* constrain logos */
.left img{
  max-width:48px !important;
  max-height:48px !important;
  width:auto;
  height:auto;
  object-fit:contain !important;
  border-radius:8px;
}

.center{
  flex:1;
  min-width:0;
}

.title-row{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:12px;
}

.name{
  font-weight:700;
  font-size:16px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.tagline{
  color:#111;
  margin-top:8px;
  font-size:14px;
  line-height:1.3;
}

.meta{
  margin-top:8px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

/* generic tag */
.tag{
  padding:6px 8px;
  border-radius:999px;
  background:var(--tag-bg);
  font-size:12px;
  color:#222;
  border:1px solid rgba(0,0,0,0.03);
}

/* YC W24 pill */
.tag--yc{
  background:#ffedd5;
  color:#9a3412;
  border-color:#fed7aa;
}

/* actions */
.actions{
  display:flex;
  gap:8px;
  align-items:center;
}

.btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:6px 8px;
  border-radius:10px;
  font-weight:600;
  text-decoration:none;
  font-size:13px;
  border:1px solid var(--border);
  background:#fff;
  color:#111;
  box-shadow:0 1px 0 rgba(0,0,0,0.03);
}

.btn svg{
  width:18px;
  height:18px;
  display:block;
}

.btn--site{
  border-color:#dbeafe;
}

.btn--page{
  border-color:#ffd8cc;
  background:#fff;
}

.title-row > .actions{
  min-width:86px;
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:8px;
}

/* empty state */
.empty{
  color:var(--muted);
  padding:28px;
  background:var(--card);
  border:1px dashed var(--border);
  border-radius:8px;
  text-align:center;
  margin-top:16px;
}

footer{
  margin-top:26px;
  color:var(--muted);
  font-size:13px;
}

/* responsive */
@media (max-width:740px){
  .controls{
    flex-direction:column;
    align-items:stretch;
  }
  .search{
    width:100%;
    margin-left:0;
  }
  .title-row{
    flex-direction:column;
    align-items:flex-start;
  }
  .title-row > .actions{
    flex-direction:row;
    align-items:center;
    margin-top:8px;
  }
}
</style>
</head>

<body>
<div class="app">
  <div class="header">
    <div class="logo">
      <img src="icons8-ghost.gif" alt="logo">
    </div>
    <div class="title-wrapper">
      <h1>DiscoveryOS</h1>
      <div class="subtitle">Your radar for breakout startups ðŸš€</div>
    </div>
  </div>

  <div class="controls">
    <input id="search" class="search" type="text"
      placeholder="Search company or tagline" />
  </div>

  <div id="content"></div>
</div>

<script>
/* === CONFIG === */
const SHEET_ID = '1OaIx6CeopLNuiYQrDUurO_6B-cCHh3g2QMWtC7UDz5U';
const GID = '1778821196';
const CSV_URL =
  `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`;

/* === CSV HELPERS === */
function splitCsvLine(line){
  const out=[]; let cur='', q=false;
  for(let i=0;i<line.length;i++){
    const ch=line[i];
    if(ch==='\"'){
      if(q && line[i+1]==='\"'){cur+='"';i++;continue;}
      q=!q;continue;
    }
    if(ch===',' && !q){out.push(cur);cur='';continue;}
    cur+=ch;
  }
  out.push(cur);
  return out.map(s=>s.trim().replace(/^"|"$/g,''));
}

function csvToObjects(csv){
  const lines = csv.split(/\r?\n/).filter(x=>x.trim());
  if(!lines.length) return [];
  const header = splitCsvLine(lines[0]);
  return lines.slice(1).map(l=>{
    const cols = splitCsvLine(l);
    const o={};
    header.forEach((h,i)=>o[h]=cols[i]||'');
    return o;
  });
}

/* === UTILS === */
function pick(r, list){
  for(const k of list){
    if(k in r && r[k] && r[k].trim()) return r[k].trim();
  }
  return "";
}

function getDomain(url){
  try{
    if(!url) return null;
    const u = url.startsWith('http') ? url : `https://${url}`;
    return new URL(u).hostname;
  }catch(e){ return null; }
}

function favicon(url){
  const domain = getDomain(url);
  return domain ? `https://www.google.com/s2/favicons?sz=128&domain=${domain}` : null;
}

/* ONLY PH USES Logo URL, YC uses favicon */
function companyLogo(row){
  const src = pick(row, ['source','Source']).toLowerCase();
  const logoUrl = pick(row, ['Logo URL','LogoURL','Logo_Url']);
  const website = pick(row, ['Website']);

  if (src === 'ph' && logoUrl){
    return logoUrl;          // PH uses Logo URL
  }
  return favicon(website);   // YC (and others) use favicon
}

function parseDate(r){
  const d = pick(r,['Extracted Date','ExtractedDate','Date']);
  const dt=new Date(d);
  return isNaN(dt)? d : dt.toISOString().slice(0,10);
}

function formatDate(d){
  const dt=new Date(d);
  return isNaN(dt)? d : dt.toLocaleDateString(
    undefined,
    {year:'numeric',month:'long',day:'numeric'}
  );
}

function groupByDate(rows){
  const g={};
  rows.forEach(r=>{
    const key=parseDate(r)||'Unknown';
    if(!g[key]) g[key]=[];
    g[key].push(r);
  });
  return g;
}

function esc(s){
  return String(s||'')
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;');
}

/* icons */
const siteIcon = `
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none">
  <circle cx="12" cy="12" r="10" stroke="currentColor"/>
  <path d="M2 12h20M12 2c2.5 2.8 4 6.5 4 10s-1.5 7.2-4 10M12 2C9.5 4.8 8 8.5 8 12s1.5 7.2 4 10" stroke="currentColor"/>
</svg>`;

/* simple YC square icon */
const ycPageIcon = `
<svg width="20" height="20" viewBox="0 0 24 24">
  <rect x="3" y="3" width="18" height="18" rx="4" fill="#FF8A00"/>
  <path d="M9 8l3 4 3-4" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
  <path d="M12 12v4" stroke="#fff" stroke-width="1.5" stroke-linecap="round"/>
</svg>`;

/* simple Product Hunt circular icon */
const phPageIcon = `
<svg width="20" height="20" viewBox="0 0 24 24">
  <circle cx="12" cy="12" r="10" fill="#FF6A00"/>
  <path d="M9 8h4a3 3 0 0 1 0 6H9V8z" fill="#fff"/>
  <rect x="9" y="8" width="2" height="8" fill="#fff"/>
</svg>`;

/* === RENDER === */
function render(groups, txt){
  const q=(txt||'').toLowerCase();
  const keys=Object.keys(groups).sort((a,b)=>b.localeCompare(a));
  const c=document.getElementById('content');
  let html='';

  keys.forEach(date=>{
    const items = groups[date].filter(r=>{
      const name = pick(r,['Correct Name','CorrectName','Name']);
      const tagline = pick(r,['Correct Tagline','CorrectTagline','Tagline']);
      const src = pick(r,['source','Source']);
      // we still allow searching by source text even if not shown
      return !q || `${name} ${tagline} ${src}`.toLowerCase().includes(q);
    });

    if(!items.length) return;

    html += `<section class="date-group">
      <div class="date-header">${esc(formatDate(date))}</div>`;

    items.forEach(r=>{
      const name = pick(r,['Correct Name','CorrectName','Name']);
      if(!name || name==='#VALUE!') return;

      const tagline = pick(r,['Correct Tagline','CorrectTagline','Tagline']);
      const src     = pick(r,['source','Source']).toLowerCase();
      const site    = pick(r,['Website']);
      const pageUrl = pick(r,['YC URL','YC']); // YC URL / PH URL in same field
      const logo    = companyLogo(r);

      // Tags: only YC gets "YC W24" pill
      const tagsHtml = src === 'yc'
        ? `<span class="tag tag--yc">YC W24</span>`
        : '';

      // Which icon to use for the page link
      const pageIcon = src === 'ph' ? phPageIcon : ycPageIcon;

      html += `
      <article class="card">
        <div class="left">
          ${logo
            ? `<img src="${esc(logo)}"
                    alt="${esc(name)} logo"
                    style="max-width:48px;max-height:48px;object-fit:contain;"
                    onerror="this.style.display='none'">`
            : `<div>${esc(name[0])}</div>`}
        </div>

        <div class="center">
          <div class="title-row">
            <div style="min-width:0">
              <div class="name">${esc(name)}</div>
              ${tagline ? `<div class="tagline">${esc(tagline)}</div>` : ''}
              <div class="meta">
                ${tagsHtml}
              </div>
            </div>

            <div class="actions">
              ${site
                ? `<a class="btn btn--site" target="_blank"
                      href="${esc(site.startsWith('http')?site:'https://'+site)}">${siteIcon}</a>`
                : ''}
              ${pageUrl
                ? `<a class="btn btn--page" target="_blank"
                      href="${esc(pageUrl.startsWith('http')?pageUrl:'https://'+pageUrl)}">${pageIcon}</a>`
                : ''}
            </div>
          </div>
        </div>
      </article>`;
    });

    html += `</section>`;
  });

  c.innerHTML = html || `<div class="empty">No companies match your search</div>`;
}

/* === LOAD === */
async function load(){
  document.getElementById('content').innerHTML =
    `<div class="empty">Loading...</div>`;
  try{
    const resp = await fetch(CSV_URL);
    const txt  = await resp.text();
    const rows = csvToObjects(txt);

    const filtered = rows.filter(r=>{
      const name = pick(r,['Correct Name','CorrectName','Name']);
      return name && name !== '#VALUE!';
    });

    const groups = groupByDate(filtered);
    window.__DB = groups;
    render(groups, document.getElementById('search').value);
  }catch(e){
    document.getElementById('content').innerHTML =
      `<div class="empty">${esc(e.message)}</div>`;
  }
}

document.getElementById('search').addEventListener('input', () => {
  render(window.__DB || {}, document.getElementById('search').value);
});

load();
</script>
</body>
</html>
