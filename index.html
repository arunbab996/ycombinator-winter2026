<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<title>DiscoveryOS</title>

<style>
:root{
  --bg:#000;
  --bg-elevated:#070707;
  --bg-card:#0A0A0A;
  --border:#1A1A1A;
  --border-soft:#121212;

  --text:#F4F4F5;
  --text-soft:#9A9A9A;
  --text-softer:#6E6E6E;

  --accent:#F97316;
  --accent-soft:#F9B57A;

  --yc-pill-bg:rgba(249,115,22,0.12);
  --yc-pill-border:rgba(249,115,22,0.45);

  font-family:system-ui,-apple-system,BlinkMacSystemFont,
               "SF Pro Text","Segoe UI",Roboto,Arial,sans-serif;
}

*{box-sizing:border-box;}

html,body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
}

body{
  display:flex;
  flex-direction:column;
}

/* ---------- APP ---------- */

.app{
  flex:1;
  display:flex;
  flex-direction:column;
  padding:20px 24px 28px;
  gap:14px;
}

/* ---------- HEADER ---------- */

.app-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding-bottom:8px;
  border-bottom:1px solid var(--border-soft);
}

.brand{
  display:flex;
  gap:10px;
  align-items:center;
}

.brand-mark{
  width:30px;
  height:30px;
  border-radius:8px;
  border:1px solid #262626;
  background:#050505;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:15px;
}

.brand-name{
  font-size:13px;
  letter-spacing:0.22em;
  text-transform:uppercase;
  font-weight:500;
}

.brand-sub{
  font-size:11px;
  color:var(--text-softer);
}

.app-meta-pill{
  display:flex;
  align-items:center;
  gap:6px;
  padding:4px 10px;
  border-radius:999px;
  background:#050505;
  border:1px solid var(--border);
  font-size:11px;
  color:var(--text-soft);
}

.app-meta-dot{
  width:6px;
  height:6px;
  border-radius:999px;
  background:#22C55E;
}

/* ---------- TOOLBAR ---------- */

.toolbar{
  background:var(--bg-elevated);
  border:1px solid var(--border-soft);
  border-radius:10px;
  padding:10px 12px;
  display:flex;
  align-items:center;
  gap:12px;
}

.search-box{
  position:relative;
  flex:1;
}

.search-box input{
  width:100%;
  padding:7px 10px 7px 24px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#080808;
  color:var(--text);
  font-size:12px;
}

.search-icon{
  position:absolute;
  left:8px;
  top:50%;
  transform:translateY(-50%);
  font-size:11px;
  color:var(--text-softer);
}

.chips{
  display:flex;
  gap:6px;
}

.chip{
  font-size:11px;
  padding:4px 8px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#080808;
  color:var(--text-softer);
  cursor:pointer;
}

.chip--on{
  color:var(--text-soft);
  border-color:#3A3A3A;
}

.view-toggle{
  display:flex;
  border-radius:999px;
  overflow:hidden;
  border:1px solid var(--border);
}

.view-btn{
  padding:4px 10px;
  font-size:11px;
  background:transparent;
  color:var(--text-softer);
  border:none;
  cursor:pointer;
}

.view-btn--active{
  background:#101010;
  color:var(--text);
}

/* ---------- MAIN ---------- */

.main{
  display:flex;
  gap:24px;
}

.feed{
  flex:1;
  max-width:1200px;
  background:var(--bg-elevated);
  border:1px solid var(--border-soft);
  border-radius:10px;
  padding:10px 12px;
}

.side-panel{
  width:280px;
  display:none;
}

@media (min-width:1100px){
  .side-panel{display:block;}
}

/* ---------- FEED ---------- */

.summary{
  display:flex;
  justify-content:space-between;
  font-size:11px;
  color:var(--text-soft);
  padding-bottom:6px;
  border-bottom:1px solid var(--border-soft);
  letter-spacing:0.14em;
  text-transform:uppercase;
}

.date-group{
  margin-top:10px;
}

.date-header{
  font-size:11px;
  color:var(--text-soft);
  letter-spacing:0.16em;
  text-transform:uppercase;
  margin-bottom:4px;
}

/* ---------- ROWS ---------- */

.card{
  display:flex;
  gap:12px;
  padding:10px 12px;
  background:var(--bg-card);
  border:1px solid var(--border-soft);
  border-radius:8px;
}

.card + .card{margin-top:2px;}

.card-left{
  width:38px;
  height:38px;
  border-radius:8px;
  border:1px solid var(--border);
  background:#080808;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
}

.card-left img{
  max-width:32px;
  max-height:32px;
}

.card-center{flex:1;min-width:0;}

.card-name{
  font-size:14px;
  font-weight:500;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.card-tagline{
  font-size:12px;
  color:var(--text-softer);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.card-right{
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:6px;
}

.yc-pill{
  font-size:11px;
  padding:4px 8px;
  border-radius:999px;
  background:var(--yc-pill-bg);
  border:1px solid var(--yc-pill-border);
  color:var(--accent-soft);
  opacity:0.85;
}

.card-link-row{
  display:flex;
  gap:4px;
}

.btn-link{
  width:26px;
  height:26px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#080808;
  color:var(--text-soft);
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0.7;
}

.card:hover .btn-link{opacity:1}

/* ---------- TABLE ---------- */

.table-view{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
  margin-top:8px;
}

.table-view th,
.table-view td{
  padding:6px 8px;
  border-bottom:1px solid var(--border-soft);
}

.table-view th{
  font-size:11px;
  color:var(--text-soft);
  text-transform:uppercase;
  letter-spacing:0.12em;
  text-align:left;
}

.table-tagline{
  color:var(--text-soft);
}

/* ---------- EMPTY ---------- */

.empty{
  padding:20px 10px;
  font-size:13px;
  color:var(--text-soft);
  text-align:center;
}

/* ---------- FOOTER ---------- */

.footer{
  padding:10px 24px 14px;
  font-size:11px;
  color:var(--text-softer);
  display:flex;
  justify-content:space-between;
}

.footer a{
  color:#E4E4E7;
  text-decoration:none;
}
</style>
</head>

<body>
<div class="app">

<header class="app-header">
  <div class="brand">
    <div class="brand-mark">▦</div>
    <div>
      <div class="brand-name">DISCOVERY OS</div>
      <div class="brand-sub">Market intelligence on emerging companies</div>
    </div>
  </div>
  <div class="app-meta-pill">
    <span class="app-meta-dot"></span>
    <span id="last-updated">Syncing…</span>
  </div>
</header>

<section class="toolbar">
  <div class="search-box">
    <span class="search-icon">⌕</span>
    <input id="search" placeholder="Search by company or tagline" />
  </div>
  <div class="chips">
    <button class="chip chip--on" data-filter="all">All</button>
    <button class="chip" data-filter="yc">YC W26</button>
    <button class="chip" data-filter="ph">Product Hunt</button>
  </div>
  <div class="view-toggle">
    <button class="view-btn view-btn--active" data-view="cards">Cards</button>
    <button class="view-btn" data-view="table">Table</button>
  </div>
</section>

<div class="main">
  <section class="feed">
    <div class="summary">
      <span id="summary-text">Loading…</span>
      <span id="summary-breakdown"></span>
    </div>
    <div id="content"></div>
  </section>
  <aside class="side-panel"></aside>
</div>

</div>

<footer class="footer">
  <span>© DiscoveryOS</span>
  <span><a href="#">Docs</a> · <a href="#">Changelog</a></span>
</footer>

<script>
/* ---------- CONFIG ---------- */
const SHEET_ID='1OaIx6CeopLNuiYQrDUurO_6B-cCHh3g2QMWtC7UDz5U';
const GID='1778821196';
const CSV_URL=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`;

let STATE={groups:{},search:"",source:"all",view:"cards"};

/* ---------- CSV HELPERS ---------- */
function splitCsvLine(line){
  const out=[];let cur='',q=false;
  for(let i=0;i<line.length;i++){
    const ch=line[i];
    if(ch==='\"'){ q=!q; continue; }
    if(ch===','&&!q){ out.push(cur); cur=''; continue; }
    cur+=ch;
  }
  out.push(cur);
  return out.map(s=>s.trim().replace(/^"|"$/g,''));
}

function csvToObjects(csv){
  const lines=csv.split(/\r?\n/).filter(x=>x.trim());
  const h=splitCsvLine(lines[0]);
  return lines.slice(1).map(l=>{
    const cols=splitCsvLine(l),o={};
    h.forEach((hh,i)=>o[hh]=cols[i]||'');
    return o;
  });
}

function pick(r,k){
  for(const x of k){
    if(r[x] && r[x].trim()) return r[x].trim();
  }
  return "";
}

function favicon(u){
  try{
    const d=new URL(u.startsWith('http')?u:`https://${u}`).hostname;
    return `https://www.google.com/s2/favicons?sz=128&domain=${d}`;
  }catch{return null;}
}

function parseDate(r){
  const d=pick(r,['Extracted Date','Date']);
  const dt=new Date(d);
  return isNaN(dt)?d:dt.toISOString().slice(0,10);
}

function formatDate(d){
  const dt=new Date(d);
  return isNaN(dt)?d:
    dt.toLocaleDateString(undefined,{year:'numeric',month:'short',day:'2-digit'});
}

/* ---------- ICONS ---------- */
const siteIcon=`<svg width="16" height="16" viewBox="0 0 24 24">
<path d="M9 5h10v10M9 15L19 5M5 9v10h10"
fill="none" stroke="currentColor" stroke-width="1.6"
stroke-linecap="round" stroke-linejoin="round"/></svg>`;

const ycIcon=`<svg width="16" height="16" viewBox="0 0 24 24">
<rect x="4" y="4" width="16" height="16" rx="3" fill="#FF8A00"/>
<text x="12" y="15" text-anchor="middle"
font-size="10" fill="#FFF">Y</text></svg>`;

const phIcon=`<svg width="16" height="16" viewBox="0 0 24 24">
<circle cx="12" cy="12" r="9" fill="#FF6A00"/>
<path d="M10 8h3.2a2.8 2.8 0 010 5.6H10z" fill="#FFF"/>
<rect x="10" y="8" width="2" height="8" fill="#FFF"/></svg>`;

function iconFor(src){ return src==='ph'?phIcon:ycIcon; }

/* ---------- RENDER ---------- */
function render(){
  const cont=document.getElementById('content');
  const sum=document.getElementById('summary-text');
  const br=document.getElementById('summary-breakdown');

  let rows=[],total=0,yc=0,ph=0;

  Object.values(STATE.groups).flat().forEach(r=>{
    const n=pick(r,['Correct Name','Name']);
    if(!n) return;

    const src=(pick(r,['source','Source'])||'').toLowerCase();
    if(STATE.source!=='all' && src!==STATE.source) return;

    const tag=pick(r,['Correct Tagline','Tagline']);
    const q=STATE.search.toLowerCase();
    if(q && !(n+' '+tag).toLowerCase().includes(q)) return;

    total++;
    if(src==='yc') yc++;
    if(src==='ph') ph++;

    rows.push({r,n,tag,src});
  });

  sum.textContent=`Showing ${total} companies`;
  br.textContent=`YC: ${yc} · PH: ${ph}`;

  if(!rows.length){
    cont.innerHTML='<div class="empty">No results</div>';
    return;
  }

  if(STATE.view==='table'){
    cont.innerHTML=`<table class="table-view"><tbody>`+
      rows.map(x=>`
        <tr>
          <td>${x.n}</td>
          <td class="table-tagline">${x.tag||''}</td>
          <td>${x.src.toUpperCase()}</td>
        </tr>`).join('')+
      `</tbody></table>`;
  }else{
    cont.innerHTML=rows.map(x=>`
      <article class="card">
        <div class="card-left">${x.n[0]}</div>
        <div class="card-center">
          <div class="card-name">${x.n}</div>
          <div class="card-tagline">${x.tag||''}</div>
        </div>
        <div class="card-right">
          ${x.src==='yc'?'<div class="yc-pill">YC W26</div>':''}
        </div>
      </article>`).join('');
  }
}

/* ---------- LOAD ---------- */
async function load(){
  try{
    const txt=await (await fetch(CSV_URL)).text();
    const rows=csvToObjects(txt);
    STATE.groups={all:rows};
    render();
    const d=new Date();
    document.getElementById('last-updated').textContent=
      `Last sync ${d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}`;
  }catch(e){
    document.getElementById('content').innerHTML='<div class="empty">Error loading data</div>';
  }
}

document.getElementById('search').addEventListener('input',e=>{
  STATE.search=e.target.value;
  render();
});

document.querySelectorAll('.chip').forEach(c=>{
  c.onclick=()=>{
    STATE.source=c.dataset.filter;
    document.querySelectorAll('.chip').forEach(x=>x.classList.remove('chip--on'));
    c.classList.add('chip--on');
    render();
  };
});

document.querySelectorAll('.view-btn').forEach(b=>{
  b.onclick=()=>{
    STATE.view=b.dataset.view;
    document.querySelectorAll('.view-btn').forEach(x=>x.classList.remove('view-btn--active'));
    b.classList.add('view-btn--active');
    render();
  };
});

load();
</script>
</body>
</html>
