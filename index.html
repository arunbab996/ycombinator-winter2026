<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DiscoveryOS – Find the Next Big thing, Today! </title>

<style>
:root{
  --bg:#020309;
  --bg-elevated:#050712;
  --bg-card:#070818;
  --border:#1e1e28;
  --border-soft:#151521;
  --text:#f9fafb;
  --text-soft:#9ca3af;
  --text-softer:#6b7280;
  --accent:#f97316;
  --accent-soft:#fed7aa;
  --accent-ph:#fb7185;
  --accent-link:#38bdf8;
  --yc-pill-bg:rgba(249,115,22,0.12);
  --yc-pill-border:rgba(249,115,22,0.7);
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
}

*{box-sizing:border-box;}

html,body{
  margin:0;
  padding:0;
  background:var(--bg);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
}

/* layout */
.app{
  max-width:1120px;
  margin:32px auto 40px;
  padding:0 16px;
  display:flex;
  flex-direction:column;
  gap:16px;
}

/* header – super minimal */
.app-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
}

.brand{
  display:flex;
  align-items:center;
  gap:10px;
}

.brand-mark{
  width:24px;
  height:24px;
  border-radius:8px;
  background:#0b0f1a;
  border:1px solid #1e293b;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:11px;
  color:var(--accent-soft);
}

.brand-text{
  display:flex;
  flex-direction:column;
  gap:2px;
}

.brand-name{
  font-size:13px;
  letter-spacing:0.2em;
  text-transform:uppercase;
}

.brand-sub{
  font-size:11px;
  color:var(--text-soft);
}

.app-meta{
  font-size:11px;
  color:var(--text-soft);
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:4px;
}

.app-meta-pill{
  border-radius:999px;
  padding:4px 9px;
  border:1px solid var(--border);
  background:#020617;
  display:flex;
  align-items:center;
  gap:6px;
}

.app-meta-dot{
  width:6px;
  height:6px;
  border-radius:999px;
  background:#22c55e;
}

/* toolbar */
.toolbar{
  background:var(--bg-elevated);
  border-radius:12px;
  border:1px solid var(--border-soft);
  padding:10px 10px 10px 12px;
  display:flex;
  align-items:center;
  gap:10px;
}

.toolbar-main{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:6px;
}

.toolbar-title{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:0.22em;
  color:var(--text-soft);
}

.toolbar-sub{
  font-size:11px;
  color:var(--text-softer);
}

/* search */
.search-wrap{
  display:flex;
  align-items:center;
  gap:8px;
  margin-top:4px;
}

.search-box{
  position:relative;
  flex:1;
}

.search-box input{
  width:100%;
  padding:7px 10px 7px 24px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#020617;
  color:var(--text);
  font-size:12px;
  outline:none;
}
.search-box input::placeholder{
  color:#4b5563;
}

.search-icon{
  position:absolute;
  left:8px;
  top:50%;
  transform:translateY(-50%);
  font-size:11px;
  color:var(--text-softer);
}

/* chips */
.chips{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  font-size:11px;
}

.chip{
  padding:4px 8px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#020617;
  color:var(--text-softer);
  cursor:pointer;
}
.chip--on{
  border-color:#4b5563;
  color:var(--text-soft);
}

/* feed container */
.feed{
  margin-top:4px;
  background:var(--bg-elevated);
  border-radius:14px;
  border:1px solid var(--border-soft);
  padding:10px;
  max-height:520px;
  overflow:auto;
}

/* summary bar */
.summary{
  font-size:11px;
  color:var(--text-soft);
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 2px 6px;
}

/* date groups */
.date-group{
  margin-top:14px;
}
.date-group:first-child{
  margin-top:0;
}

.date-header{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:0.16em;
  color:var(--text-soft);
  margin-bottom:8px;
}

/* cards */
.card{
  display:flex;
  align-items:flex-start;
  gap:12px;
  padding:10px 11px;
  border-radius:10px;
  background:var(--bg-card);
  border:1px solid var(--border-soft);
}
.card + .card{
  margin-top:8px;
}

/* logo */
.card-left{
  width:40px;
  height:40px;
  border-radius:10px;
  background:#020617;
  border:1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
  overflow:hidden;
}
.card-left img{
  max-width:34px !important;
  max-height:34px !important;
  width:auto;
  height:auto;
  object-fit:contain !important;
}
.card-left-fallback{
  font-size:12px;
  color:var(--text-soft);
}

/* center info */
.card-center{
  flex:1;
  min-width:0;
}

.card-top-row{
  display:flex;
  align-items:flex-start;
  gap:10px;
}

.card-main{
  flex:1;
  min-width:0;
}

.card-name{
  font-size:14px;
  font-weight:500;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.card-tagline{
  margin-top:5px;
  font-size:12px;
  color:var(--text-soft);
  line-height:1.35;
}

/* right side actions */
.card-right{
  display:flex;
  flex-direction:column;
  gap:6px;
  align-items:flex-end;
  flex-shrink:0;
}

/* YC pill */
.yc-pill{
  padding:4px 8px;
  border-radius:999px;
  font-size:11px;
  font-weight:500;
  background:var(--yc-pill-bg);
  border:1px solid var(--yc-pill-border);
  color:var(--accent-soft);
}

/* link buttons */
.btn-link{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:26px;
  height:26px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#020617;
  color:var(--text-soft);
  text-decoration:none;
}
.btn-link + .btn-link{
  margin-left:4px;
}
.card-link-row{
  display:flex;
  align-items:center;
  gap:4px;
}

/* empty state */
.empty{
  padding:24px 10px;
  font-size:13px;
  color:var(--text-soft);
  text-align:center;
}

/* footer */
.footer{
  margin-top:10px;
  font-size:11px;
  color:var(--text-softer);
  display:flex;
  justify-content:space-between;
  gap:8px;
}
.footer a{
  color:var(--accent-link);
  text-decoration:none;
}

/* scrollbars */
.feed::-webkit-scrollbar{
  width:6px;
}
.feed::-webkit-scrollbar-track{
  background:transparent;
}
.feed::-webkit-scrollbar-thumb{
  background:#111827;
  border-radius:999px;
}

/* responsive */
@media (max-width:720px){
  .app-header{
    flex-direction:column;
    align-items:flex-start;
  }
  .toolbar{
    flex-direction:column;
    align-items:flex-start;
  }
  .card-top-row{
    flex-direction:column;
    align-items:flex-start;
  }
  .card-right{
    flex-direction:row;
    align-items:center;
  }
}
</style>
</head>

<body>
<div class="app">
  <header class="app-header">
    <div class="brand">
      <div class="brand-mark">OS</div>
      <div class="brand-text">
        <div class="brand-name">DISCOVERYOS</div>
        <div class="brand-sub">New company timeline for VCs & analysts</div>
      </div>
    </div>
    <div class="app-meta">
      <div class="app-meta-pill">
        <span class="app-meta-dot"></span>
        <span id="last-updated">Syncing from sheet…</span>
      </div>
      <div>Sheet → CSV → UI. Nothing else.</div>
    </div>
  </header>

  <section class="toolbar">
    <div class="toolbar-main">
      <div class="toolbar-title">Today’s feed</div>
      <div class="toolbar-sub">
        Grouped by <strong>Extracted Date</strong>. Search runs across name & tagline.
      </div>
      <div class="search-wrap">
        <div class="search-box">
          <span class="search-icon">⌕</span>
          <!-- search input -->
          <input id="search" type="text" placeholder="Search by company or tagline" />
        </div>
        <div class="chips">
          <button class="chip chip--on" data-filter="all">All</button>
          <button class="chip" data-filter="yc">YC W26</button>
          <button class="chip" data-filter="ph">Product Hunt</button>
        </div>
      </div>
    </div>
  </section>

  <section class="feed">
    <div class="summary">
      <span id="summary-text">Showing 0 companies</span>
      <span id="summary-breakdown"></span>
    </div>
    <div id="content" class="content"></div>
  </section>

  <footer class="footer">
    <span>© DiscoveryOS. Internal-style feed for market scouts, not a marketing site.</span>
    <span>
      <a href="#">Docs</a> · <a href="#">Changelog</a>
    </span>
  </footer>
</div>

<script>
/* --- CONFIG (same sheet + gid) --- */
const SHEET_ID='1OaIx6CeopLNuiYQrDUurO_6B-cCHh3g2QMWtC7UDz5U';
const GID='1778821196';
const CSV_URL=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`;

/* Global render state */
let DISCOVERY_STATE = {
  groups: {},
  search: "",
  sourceFilter: "all"
};

/******** CSV PARSER ********/
function splitCsvLine(line){
  const out=[]; let cur='', q=false;
  for(let i=0;i<line.length;i++){
    const ch=line[i];
    if(ch==='\"'){
      if(q && line[i+1]==='\"'){cur+='"';i++;continue;}
      q=!q;continue;
    }
    if(ch===',' && !q){out.push(cur);cur='';continue;}
    cur+=ch;
  }
  out.push(cur);
  return out.map(s=>s.trim().replace(/^"|"$/g,''));
}
function csvToObjects(csv){
  const lines=csv.split(/\r?\n/).filter(x=>x.trim());
  if(!lines.length) return [];
  const header=splitCsvLine(lines[0]);
  return lines.slice(1).map(l=>{
    const cols=splitCsvLine(l);
    const o={};
    header.forEach((h,i)=>o[h]=cols[i]||'');
    return o;
  });
}

/******** UTIL ********/
function pick(row, keys){
  for(const k of keys){
    if(k in row && row[k] && row[k].trim()) return row[k].trim();
  }
  return "";
}

function getDomain(url){
  try{
    if(!url) return null;
    const u = url.startsWith('http') ? url : `https://${url}`;
    return new URL(u).hostname;
  }catch(e){
    return null;
  }
}

function favicon(url){
  const domain=getDomain(url);
  return domain
    ? `https://www.google.com/s2/favicons?sz=128&domain=${domain}`
    : null;
}

/* If PH, use logo column; else favicon of website */
function companyLogo(row){
  const src  = pick(row,['source','Source']).toLowerCase();
  const logo = pick(row,['Logo URL','LogoURL','Logo_Url']);
  const site = pick(row,['Website']);

  if(src==='ph' && logo) return logo;
  return favicon(site);
}

function parseDate(row){
  const d = pick(row,['Extracted Date','ExtractedDate','Date']);
  const dt = new Date(d);
  return isNaN(dt)? d : dt.toISOString().slice(0,10);
}

function formatDate(d){
  const dt=new Date(d);
  if(isNaN(dt)) return d || 'Unknown date';
  return dt.toLocaleDateString(undefined,{
    year:'numeric',month:'short',day:'2-digit'
  });
}

function groupByDate(rows){
  const g={};
  rows.forEach(r=>{
    const key=parseDate(r)||'Unknown';
    if(!g[key]) g[key]=[];
    g[key].push(r);
  });
  return g;
}

function esc(s){
  return String(s||'')
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;');
}

/******** ICONS ********/
const siteIcon = `
<svg width="16" height="16" viewBox="0 0 24 24">
  <circle cx="12" cy="12" r="8.2" stroke="currentColor" stroke-width="1.4" fill="none" />
  <path d="M8 12h8M12 8v8" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" />
</svg>`;

const ycPageIcon = `
<svg width="16" height="16" viewBox="0 0 24 24">
  <rect x="4" y="4" width="16" height="16" rx="3" fill="#FF8A00" />
  <path d="M9 9l3 4 3-4" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
  <path d="M12 13v3" stroke="#fff" stroke-width="1.4" stroke-linecap="round"/>
</svg>`;

const phPageIcon = `
<svg width="16" height="16" viewBox="0 0 24 24">
  <circle cx="12" cy="12" r="9" fill="#FF6A00" />
  <path d="M9 8h4a3 3 0 0 1 0 6H9V8z" fill="#fff"/>
  <rect x="9" y="8" width="2" height="8" fill="#fff"/>
</svg>`;

function pageIconFor(src){
  return src==='ph' ? phPageIcon : ycPageIcon;
}

/******** RENDER ********/
function render(){
  const groups = DISCOVERY_STATE.groups || {};
  const searchText = (DISCOVERY_STATE.search || "").toLowerCase().trim();
  const filter = DISCOVERY_STATE.sourceFilter || "all";

  const container=document.getElementById('content');
  const summaryTextEl = document.getElementById('summary-text');
  const summaryBreakdownEl = document.getElementById('summary-breakdown');

  const dates=Object.keys(groups).sort((a,b)=>b.localeCompare(a));
  let html='';
  let total=0, ycCount=0, phCount=0;

  dates.forEach(date=>{
    const rows = groups[date];
    const filtered = rows.filter(row=>{
      const name = pick(row,['Correct Name','CorrectName','Name']);
      const tagline = pick(row,['Correct Tagline','CorrectTagline','Tagline']);
      const src     = pick(row,['source','Source']).toLowerCase();

      if(filter==='yc' && src!=='yc') return false;
      if(filter==='ph' && src!=='ph') return false;

      if(!searchText) return true;
      return (name+' '+tagline).toLowerCase().includes(searchText);
    });

    if(!filtered.length) return;

    html += `<section class="date-group">
      <div class="date-header">${esc(formatDate(date))}</div>`;

    filtered.forEach(row=>{
      const name = pick(row,['Correct Name','CorrectName','Name']);
      if(!name || name==='#VALUE!') return;

      const tagline = pick(row,['Correct Tagline','CorrectTagline','Tagline']);
      const src     = pick(row,['source','Source']).toLowerCase();
      const site    = pick(row,['Website']);
      const pageUrl = pick(row,['YC URL','YC']);
      const logoUrl = companyLogo(row);

      total++;
      if(src==='yc') ycCount++;
      if(src==='ph') phCount++;

      const ycTag = src==='yc'
        ? `<div class="yc-pill">YC W26</div>`
        : '';

      const siteHref = site
        ? (site.startsWith('http') ? site : `https://${site}`)
        : null;
      const pageHref = pageUrl
        ? (pageUrl.startsWith('http') ? pageUrl : `https://${pageUrl}`)
        : null;

      html += `
      <article class="card">
        <div class="card-left">
          ${logoUrl
            ? `<img src="${esc(logoUrl)}" alt="${esc(name)} logo"
                    onerror="this.style.display='none'">`
            : `<div class="card-left-fallback">${esc(name[0]||'•')}</div>`
          }
        </div>
        <div class="card-center">
          <div class="card-top-row">
            <div class="card-main">
              <div class="card-name">${esc(name)}</div>
              ${tagline ? `<div class="card-tagline">${esc(tagline)}</div>` : ''}
            </div>
            <div class="card-right">
              ${ycTag}
              <div class="card-link-row">
                ${siteHref
                  ? `<a class="btn-link" target="_blank" href="${esc(siteHref)}"
                       title="Open website">${siteIcon}</a>`
                  : ''}
                ${pageHref
                  ? `<a class="btn-link" target="_blank" href="${esc(pageHref)}"
                       title="Open listing">${pageIconFor(src)}</a>`
                  : ''}
              </div>
            </div>
          </div>
        </div>
      </article>`;
    });

    html += `</section>`;
  });

  container.innerHTML = html || `<div class="empty">No companies match this search/filter.</div>`;

  // Summary
  summaryTextEl.textContent = `Showing ${total} compan${total === 1 ? 'y' : 'ies'}`;
  summaryBreakdownEl.textContent = `YC: ${ycCount} · PH: ${phCount}`;
}

/******** LOAD ********/
async function load(){
  const content=document.getElementById('content');
  const lastUpdatedEl=document.getElementById('last-updated');
  content.innerHTML=`<div class="empty">Loading from Google Sheets…</div>`;

  try{
    const resp = await fetch(CSV_URL);
    const text = await resp.text();
    const rows = csvToObjects(text);

    const valid = rows.filter(r=>{
      const name = pick(r,['Correct Name','CorrectName','Name']);
      return name && name !== '#VALUE!';
    });

    const groups = groupByDate(valid);
    DISCOVERY_STATE.groups = groups;

    render();

    const now = new Date();
    lastUpdatedEl.textContent =
      'Last sync: ' +
      now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}) +
      ' · ' +
      now.toLocaleDateString([], {day:'2-digit',month:'short'});
  }catch(e){
    content.innerHTML = `<div class="empty">${esc(e.message)}</div>`;
    lastUpdatedEl.textContent='Error fetching sheet';
  }
}

/******** EVENTS ********/
document.getElementById('search').addEventListener('input', (e)=>{
  DISCOVERY_STATE.search = e.target.value || "";
  render();
});

document.querySelectorAll('.chip').forEach(chip=>{
  chip.addEventListener('click', ()=>{
    const filter = chip.getAttribute('data-filter') || 'all';
    DISCOVERY_STATE.sourceFilter = filter;

    // toggle visual state
    document.querySelectorAll('.chip').forEach(c=>{
      c.classList.toggle('chip--on', c === chip);
    });

    render();
  });
});

load();
</script>
</body>
</html>
